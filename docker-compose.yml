version: '3.8'

services:
  # ==========================================
  # Nginx (리버스 프록시 & 웹 서버)
  # ==========================================
  nginx:
    image: nginx:alpine
    container_name: blog-nginx
    ports:
      - "80:80"      # HTTP 포트
    volumes:
      # Nginx 설정 파일 마운트
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - app
    networks:
      - blog-network
    restart: unless-stopped

  # ==========================================
  # Spring Boot 애플리케이션
  # ==========================================
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: blog-app
    environment:
      # 환경변수로 설정 주입
      - SPRING_DATASOURCE_URL=${SPRING_DATASOURCE_URL:-jdbc:mysql://db:3306/blog?useSSL=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8&allowPublicKeyRetrieval=true}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME:-bloguser}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD:-blogpassword}
      - SPRING_JPA_HIBERNATE_DDL_AUTO=update
    networks:
      - blog-network
    restart: unless-stopped

# ==========================================
# 네트워크 정의
# ==========================================
networks:
  blog-network:
    driver: bridge


